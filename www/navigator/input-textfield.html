<!doctype html>
<html>
<meta charset="UTF-8">
<!--
 - Copyright 2010-2012 Esrille Inc.
 -
 - Licensed under the Apache License, Version 2.0 (the "License");
 - you may not use this file except in compliance with the License.
 - You may obtain a copy of the License at
 -
 -     http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS,
 - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 - See the License for the specific language governing permissions and
 - limitations under the License.
 -->
<head>
<style>
body
{
    background-color: silver;
}
</style>
<script>
function init() {
    document.getElementById('location').focus();
}
</script>
<binding id="input-textfield">
<template><span style="border-right: black solid 1px; margin-right: -1px;"></span><span></span></template>
<implementation>
  ({
    xblEnteredDocument: function() {
        this.boundElement.tabIndex = 0;
        this.boundElement.style.display = 'inline-block';
        this.boundElement.style.whiteSpace = 'pre';
        this.boundElement.style.backgroundColor = 'white';
        this.boundElement.style.border = '2px inset';
        this.boundElement.style.textAlign = 'left';
        this.boundElement.style.padding = '1px';
        this.boundElement.style.minHeight = '1em';
        var before = document.createTextNode(this.boundElement.value);
        var after = document.createTextNode('');
        this.shadowTree.firstChild.appendChild(before);
        this.shadowTree.lastChild.appendChild(after);
        this.addEventListener('keypress', function(event) {
            var c = event.charCode;
            if (c) {
                before.appendData(String.fromCharCode(c));
                event.currentTarget.value = before.data + after.data;
            }
        }, false);
        this.addEventListener('keydown', function(event) {
            switch (event.keyCode) {
            case 8:   // Backspace
                if (0 < before.length)
                    before.deleteData(before.length - 1, 1);
                break;
            case 35:  // End
                before.appendData(after.data);
                after.deleteData(0, after.length);
                break;
            case 36:  // Home
                after.insertData(0, before.data);
                before.deleteData(0, before.length);
                break;
            case 37:  // <-
                if (0 < before.length) {
                    var c = before.substringData(before.length - 1, 1);
                    before.deleteData(before.length - 1, 1);
                    after.insertData(0, c);
                }
                break;
            case 39:  // ->
                if (0 < after.length) {
                    var c = after.substringData(0, 1);
                    after.deleteData(0, 1);
                    before.appendData(c);
                }
                break;
            case 46:  // Del
                if (0 < after.length)
                    after.deleteData(0, 1);
                break;
            default:
                return;
            }
            event.currentTarget.value = before.data + after.data;
        }, false);
    }
  })
</implementation>
</binding>
</head>
<body onload='init()'>
<input type='text' id='location' value='http://' style='width: 8em; binding: url(#input-textfield);'>
</body>
</html>
